<div class="filter">
  <label for="usuarioSelect" class="form-label">Filtrar por usuario:</label>
  <select
    class="form-select"
    aria-label="usuarioSelect"
    [(ngModel)]="filtro"
    (change)="aplicarFiltro()"
  >
    <option value="todos">Todos</option>
    <option *ngFor="let usuario of usuariosUnicos" [value]="usuario">
      {{ usuario }}
    </option>
  </select>
</div>

<table class="table table-striped">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nombre</th>
      <th>Titulo</th>
      <th>Categoria</th>
      <th>Estado</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of elementosMostrados; let i = index">
      <td>{{ item.id }}</td>
      <td>{{ item.cliente_nombre }} {{ item.cliente_apellido }}</td>
      <td>{{ item.titulo }}</td>
      <td>{{ item.categoria }}</td>
      <td>{{ item.estado }}</td>
      <td>
        <button
          type="button"
          class="btn btn-primary"
          (click)="abrirModal(item)"
        >
          Detalles
        </button>
      </td>
    </tr>
  </tbody>
</table>

<nav aria-label="Navegación de página">
  <ul class="pagination justify-content-center">
    <li class="page-item" [class.disabled]="paginaActual === 1">
      <a
        class="page-link"
        href="javascript:void(0)"
        (click)="cambiarPagina(paginaActual - 1)"
        >Anterior</a
      >
    </li>

    <li
      class="page-item"
      *ngFor="let pagina of paginas"
      [class.active]="pagina === paginaActual"
    >
      <a
        class="page-link"
        href="javascript:void(0)"
        (click)="cambiarPagina(pagina)"
        >{{ pagina }}</a
      >
    </li>

    <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
      <a
        class="page-link"
        href="javascript:void(0)"
        (click)="cambiarPagina(paginaActual + 1)"
        >Siguiente</a
      >
    </li>
  </ul>
</nav>

<!-- Modal -->
<div
  class="modal fade"
  id="exampleModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          Ticket numero: {{ ticketSeleccionado?.id }}
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <h1 class="text-uppercase">Información del cliente</h1>
          <p class="mb-1">
            <strong
              >{{ ticketSeleccionado?.cliente_nombre }}
              {{ ticketSeleccionado?.cliente_apellido }}</strong
            >
          </p>
          <p class="mb-0">
            {{ ticketSeleccionado?.cliente_email }}
          </p>
        </div>

        <hr />

        <div class="mb-3">
          <h1 class="text-uppercase">Detalles del ticket</h1>
          <p class="mb-1">
            <strong>Categoría:</strong> {{ ticketSeleccionado?.categoria }}
          </p>
          <p class="mb-1">
            <strong>Estado:</strong>
            <span
              class="badge"
              [ngClass]="{
                'bg-danger': ticketSeleccionado?.estado === 'CERRADO',
                'bg-warning text-dark':
                  ticketSeleccionado?.estado === 'ASIGNADO',
                'bg-secondary': ticketSeleccionado?.estado === 'PENDIENTE'
              }"
            >
              {{ ticketSeleccionado?.estado }}
            </span>
          </p>
          <p class="mb-1">
            <strong>Creación:</strong>
            {{
              ticketSeleccionado?.fechaCreacion | date : "hh:mm - dd/MM/yyyy"
            }}
          </p>
          <p class="mb-0">
            <strong>Cierre:</strong>
            {{ ticketSeleccionado?.fechaCierre | date : "hh:mm - dd/MM/yyyy" }}
          </p>
        </div>

        <hr />

        <div>
          <h1 class="text-uppercase">Descripción</h1>
          <p>{{ ticketSeleccionado?.descripcion }}</p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
